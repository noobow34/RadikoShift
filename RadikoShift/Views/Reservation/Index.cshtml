@using RadikoShift.EF
@model IEnumerable<RadikoShift.EF.Reservation>
<div class="container">
    <h3 class="mb-3">📻 予約一覧</h3>

    <div id="reservation-container">
        @await Html.PartialAsync("_ReservationList", Model)
    </div>
</div>

@functions {
    string RenderSchedule(Reservation r)
    {
        return r.RepeatType switch
        {
            RepeatType.Once =>
                $"{r.TargetDate:yyyy/MM/dd(ddd)} {r.StartTime:HH:mm} - {r.EndTime:HH:mm}",

            RepeatType.Daily =>
                $"毎日 {r.StartTime:HH:mm} - {r.EndTime:HH:mm}",

            RepeatType.Weekly =>
                $"毎週 {r.RepeatDays!.Value.ToJapanese()} {r.StartTime:HH:mm} - {r.EndTime:HH:mm}",

            _ => "-"
        };
    }
}

@section Scripts {
    <script>
        $(document).on('click', '.cancel-btn', function () {
            const id = $(this).data('id');

            if (!confirm('この予約をキャンセルしますか？')) return;

            $.post('/Reservation/Cancel', { id: id })
                .done(function () {
                    reloadReservationList();
                })
                .fail(function () {
                    alert('キャンセルに失敗しました');
                });
        });

        function reloadReservationList() {
            $('#reservation-container')
                .load('/Reservation/ListPartial');
        }
    </script>
}