@using RadikoShift.EF
@model IEnumerable<Reservation>

<div id="reservation-list">
    <div class="container">
        <!-- PC: Table -->
        <div class="d-none d-md-block">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>番組</th>
                        <th>出演</th>
                        <th>局</th>
                        <th>種別</th>
                        <th>スケジュール</th>
                        <th>状態</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var r in Model)
                    {
                        <tr>
                            <td>
                                <span class="program-label" data-id="@r.Id">
                                    @r.ProgramName
                                </span>
                                <input class="form-control form-control-sm program-edit d-none"
                                        data-id="@r.Id"
                                        value="@r.ProgramName" />

                                <div class="btn-group btn-group-sm ms-1 edit-controls d-none" data-id="@r.Id">
                                    <button class="btn btn-outline-primary save-name-btn" data-id="@r.Id">保存</button>
                                    <button class="btn btn-outline-secondary cancel-edit-btn" data-id="@r.Id">取消</button>
                                </div>

                                <button class="btn btn-sm btn-outline-secondary edit-name-btn ms-1"
                                        data-id="@r.Id">
                                    ✏️
                                </button>
                            </td>
                            <td>@r.CastName</td>
                            <td>@r.StationName</td>
                            <td>@r.RepeatType</td>
                            <td>@RenderSchedule(r)</td>
                            <td>
                                <span class="badge bg-secondary">@r.Status</span>
                            </td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-danger cancel-btn"
                                        data-id="@r.Id">
                                    ❌
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Mobile: Compact Card -->
        <div class="d-md-none">
            @foreach (var r in Model)
            {
                <div class="card mb-1 shadow-sm">
                    <div class="card-body py-2 px-3">

                        <div class="d-flex align-items-center justify-content-between">

                            <!-- 左側：情報 -->
                            <div class="me-2 w-100">

                                <!-- 番組名 -->
                                <div class="small fw-semibold">
                                    <span class="program-label" data-id="@r.Id">
                                        @r.ProgramName
                                    </span>
                                </div>

                                <!-- 編集UI（入力 + 保存取消） -->
                                <input class="form-control form-control-sm program-edit d-none mt-1"
                                       data-id="@r.Id"
                                       value="@r.ProgramName" />

                                <div class="btn-group btn-group-sm mt-1 edit-controls d-none" data-id="@r.Id">
                                    <button class="btn btn-outline-primary save-name-btn" data-id="@r.Id">保存</button>
                                    <button class="btn btn-outline-secondary cancel-edit-btn" data-id="@r.Id">取消</button>
                                </div>

                                <div class="small text-muted mt-1">
                                    @r.CastName / @r.StationName
                                </div>

                                <div class="small text-muted">
                                    @RenderSchedule(r)
                                </div>

                                <div class="small mt-1">
                                    <span class="badge bg-info me-1">@r.RepeatType</span>
                                    <span class="badge bg-secondary">@r.Status</span>
                                </div>
                            </div>

                            <!-- 右側：操作ボタン群 -->
                            <div class="text-nowrap ms-2">

                                <button class="btn btn-sm btn-outline-secondary edit-name-btn me-1"
                                        data-id="@r.Id">
                                    ✏
                                </button>

                                <button class="btn btn-sm btn-outline-danger cancel-btn"
                                        data-id="@r.Id">
                                    ❌
                                </button>

                            </div>

                        </div>

                    </div>
                </div>
            }
        </div>
</div>
</div>

@functions {
    string RenderSchedule(Reservation r)
    {
        return r.RepeatType switch
        {
            RepeatType.Once =>
                $"{r.TargetDate:yyyy/MM/dd(ddd)} {r.StartTime:HH:mm} - {r.EndTime:HH:mm}",

            RepeatType.Daily =>
                $"毎日 {r.StartTime:HH:mm} - {r.EndTime:HH:mm}",

            RepeatType.Weekly =>
                $"毎週 {r.RepeatDays!.Value.ToJapanese()} {r.StartTime:HH:mm} - {r.EndTime:HH:mm}",

            _ => "-"
        };
    }
}